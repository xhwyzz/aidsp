{"version":3,"sources":["index.js"],"names":["Option","Select","getBase64","img","callback","reader","FileReader","addEventListener","result","readAsDataURL","Demo","state","loading","Options","data","fileList","handleSubmit","e","preventDefault","console","log","props","form","validateFields","err","values","id","fetch","window","location","protocol","host","method","headers","body","name","project_id","describe","quantity_detials","imageUrl","then","res","pid","pathname","split","length","status","Modal","success","content","onOk","href","error","title","normFile","Array","isArray","handleChange","info","file","originFileObj","setState","params","reqwest","url","user_data","map","station","value","project_name","setFieldsValue","path","uploadOnchange","slice","response","showpreview","this","getFieldDecorator","previewVisible","previewImage","uploadButton","type","className","labelCol","span","wrapperCol","onSubmit","Item","label","rules","required","message","placeholder","showSearch","filterOption","input","option","children","toLowerCase","indexOf","getValueFromEvent","action","onChange","showUploadList","showPreviewIco","showRemoveIcon","showDownloadIcon","onPreview","listType","src","alt","style","width","visible","footer","onCancel","handleCancel","offset","htmlType","React","Component","WrappedDemo","Form","create","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.e235767c.chunk.js","sourcesContent":["\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'antd/dist/antd.css';\r\nimport './index.css';\r\nimport {\r\n  Form,\r\n  Select,\r\n  InputNumber,\r\n  Switch,\r\n  Radio,\r\n  Slider,\r\n  Button,\r\n  Upload,\r\n  Icon,\r\n  Rate,\r\n  Checkbox,\r\n  Row,\r\n  Col,\r\n  Input,\r\n  Modal,\r\n} from 'antd';\r\nimport reqwest from 'reqwest';\r\nconst { Option } = Select;\r\n\r\nfunction getBase64(img, callback) {\r\n  const reader = new FileReader();\r\n  reader.addEventListener('load', () => callback(reader.result));\r\n  reader.readAsDataURL(img);\r\n}\r\n\r\nclass Demo extends React.Component {\r\n  state={\r\n      loading: false,\r\n      Options:[],\r\n      data:[],\r\n      fileList:[],\r\n    };\r\n  //提交\r\n  handleSubmit = e => {\r\n    e.preventDefault();\r\n    console.log(this.state)\r\n    this.props.form.validateFields((err, values) => {\r\n      if (!err) {\r\n        console.log('Received values of form: ', values);\r\n      if (this.state.data.id){\r\n        fetch(window.location.protocol + \"//\"+window.location.host+'/aidsp/api/dataset/' + this.state.data.id + '/', {\r\n              method: 'PUT',\r\n              headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n              },\r\n              body:'name=' + values.name +\r\n              '&project='+ values.project_id + \r\n              (values.describe?'&describe='+  values.describe:'') + \r\n              (values.quantity_detials?'&quantity_detials='+ values.quantity_detials:'') + \r\n              (this.state.imageUrl?'&img='+ this.state.imageUrl:'') + \r\n              (this.state.fileList[0]?'&path=' + this.state.fileList[0].name:''),\r\n        }).then(res=>{\r\n              let pid = window.location.pathname.split(\"/\")[window.location.pathname.split(\"/\").length-2]\r\n              if (res.status == 201 || res.status == 200){\r\n                  Modal.success({\r\n                    content: '提交成功',\r\n                    onOk(){\r\n                      window.location.href = \"/aidsp/dataset_display/\" + pid + '/'\r\n                    }\r\n                  });\r\n                }\r\n              else{\r\n                  \r\n                  Modal.error({\r\n                    title: '错误'+ res.status,\r\n                    content: '提交失败',\r\n                  });\r\n              }\r\n            \r\n        })\r\n      }\r\n      else{\r\n        fetch(window.location.protocol + \"//\"+window.location.host+'/aidsp/api/dataset/', {\r\n              method: 'POST',\r\n              headers: {\r\n                \"Content-Type\": \"application/x-www-form-urlencoded\"\r\n              },\r\n              body:'name=' + values.name +\r\n              '&project='+ values.project_id + \r\n              (values.describe?'&describe='+  values.describe:'') + \r\n              (values.quantity_detials?'&quantity_detials='+ values.quantity_detials:'') + \r\n              (this.state.imageUrl?'&img='+ this.state.imageUrl:'') + \r\n              (this.state.fileList[0]?'&path=' + this.state.fileList[0].name:''),\r\n        }).then(res=>{\r\n              if (res.status == 201 || res.status == 200){\r\n                  Modal.success({\r\n                    content: '提交成功',\r\n                    onOk(){\r\n                        window.location.href = \"/aidsp/\"\r\n\r\n                    }\r\n                  });\r\n                }\r\n              else{\r\n                  \r\n                  Modal.error({\r\n                    title: '错误'+ res.status,\r\n                    content: '提交失败',\r\n                  });\r\n              }\r\n            \r\n        })\r\n      }\r\n\r\n      }\r\n    });\r\n  };\r\n\r\n  normFile = e => {\r\n    console.log('Upload event:', e);\r\n    if (Array.isArray(e)) {\r\n      return e;\r\n    }\r\n    return e && e.fileList;\r\n  };\r\n\r\n  handleChange = info => {\r\n    if (info.file.status === 'uploading') {\r\n      this.setState({ loading: true });\r\n      return;\r\n    }\r\n    if (info.file.status === 'done') {\r\n      // Get this url from response in real world.\r\n      getBase64(info.file.originFileObj, imageUrl =>\r\n        this.setState({\r\n          imageUrl,\r\n          loading: false,\r\n        }),\r\n      );\r\n    }\r\n  };\r\n  \r\n  componentDidMount() {\r\n    this.fetch();\r\n  }\r\n  fetch = (params = {}) => {\r\n    console.log('params:', params);\r\n    reqwest({\r\n      url:window.location.protocol + \"//\"+window.location.host + '/aidsp/api/project/?format=json',\r\n      // url:'http://127.0.0.1:8000/aidsp/api/user/?format=json',\r\n      method: 'get',\r\n    }).then(data => {\r\n      this.setState({user_data: data});\r\n      let Options = data.map(station  => <Option value={station.id}>{station.project_id+'_'+station.project_name}</Option>);\r\n      this.setState({Options: Options});\r\n      console.log(Options)\r\n    }); \r\n    let pid = window.location.pathname.split(\"/\")[window.location.pathname.split(\"/\").length-2]\r\n    reqwest({\r\n      url:window.location.protocol + \"//\"+window.location.host + '/aidsp/api/dataset/'+ pid +'/?format=json',\r\n      // url:'http://127.0.0.1:8000/aidsp/api/user/?format=json',\r\n      method: 'get',\r\n    }).then(data => {\r\n      this.setState({data:data})\r\n      this.setState({imageUrl:data.img})\r\n      this.props.form.setFieldsValue(data);\r\n      if (data.path){\r\n          this.setState({fileList:[{'uid':1,'name':data.path,url: window.location.protocol + \"//\"+window.location.host + '/aidsp/dataset/filedownload/' +data.path,'status':'done'}]})\r\n      }\r\n    })\r\n  };\r\n  uploadOnchange = info => {\r\n    let fileList = [...info.fileList];\r\n\r\n    // 1. Limit the number of uploaded files\r\n    // Only to show two recent uploaded files, and old ones will be replaced by the new\r\n    fileList = fileList.slice(-2);\r\n\r\n    // 2. Read from response and show file link\r\n    fileList = fileList.map(file => {\r\n      if (file.response) {\r\n        // Component will show file.url as link\r\n        file.url = file.response.url;\r\n      }\r\n      return file;\r\n    });\r\n    if (fileList[0] && fileList[0].status == 'done'){\r\n      fileList[0].name = fileList[0].response;\r\n      fileList[0].url = window.location.protocol + \"//\"+window.location.host + '/aidsp/dataset/filedownload/' + fileList[0].response;\r\n    }\r\n\r\n    this.setState({ fileList });\r\n\r\n  }\r\n  showpreview = e =>{\r\n    console.log(e)\r\n  }\r\n\r\n\r\n  render() {\r\n    const { getFieldDecorator } = this.props.form;\r\n    const formItemLayout = {\r\n      labelCol: { span: 6 },\r\n      wrapperCol: { span: 14 },\r\n    };\r\n    const { previewVisible, previewImage, fileList } = this.state;\r\n    const uploadButton = (\r\n      <div>\r\n        <Icon type={this.state.loading ? 'loading' : 'plus'} />\r\n        <div className=\"ant-upload-text\">Upload</div>\r\n      </div>\r\n    );\r\n    const { imageUrl } = this.state;\r\n\r\n    return (\r\n      <Form {...formItemLayout} onSubmit={this.handleSubmit}>\r\n        <Form.Item label=\"数据集名称\" >\r\n          {getFieldDecorator('name', {\r\n            rules: [{ required: true, message: '请输入数据集名称!' }],\r\n          })(\r\n            <Input  placeholder=\"请输入项目名称\" ></Input>,\r\n          )}\r\n        </Form.Item>\r\n        <Form.Item label=\"项目\">\r\n          {getFieldDecorator('project_id', {\r\n            rules: [{ required: true, message: '请选择所属项目!' }],\r\n          })(\r\n            <Select placeholder=\"请选择所属项目\"\r\n             showSearch \r\n             filterOption={(input, option) =>\r\n                option.props.children.toLowerCase().indexOf(input.toLowerCase()) >= 0\r\n              }>\r\n                {this.state.Options}              \r\n\r\n            </Select>,\r\n          )}\r\n        </Form.Item>\r\n    \r\n\r\n        <Form.Item label=\"数据集描述\" >\r\n          {getFieldDecorator('describe', {\r\n            \r\n          })(\r\n            <Input placeholder=\"请输入数据集描述\"></Input>,\r\n          )}\r\n        </Form.Item>\r\n        <Form.Item label=\"数量详情\" >\r\n          {getFieldDecorator('quantity_detials', {\r\n            \r\n          })(\r\n            <Input placeholder=\"请输入数量详情\"></Input>,\r\n          )}\r\n        </Form.Item>\r\n        <Form.Item label=\"存储路径\">\r\n          {getFieldDecorator('upload', {\r\n            getValueFromEvent: this.normFile,\r\n          })(\r\n              <Upload  \r\n                action='/aidsp/dataset/fileupload/'\r\n                onChange={this.uploadOnchange}\r\n                fileList={this.state.fileList}\r\n                showUploadList ={{showPreviewIco:false,showRemoveIcon:true,showDownloadIcon:true}  } \r\n                onPreview = {this.showpreview}\r\n\r\n              >\r\n                {this.state.fileList[0] ? '':\r\n                <Button>\r\n                  <Icon type=\"upload\" /> 上传文件\r\n                </Button>}\r\n\r\n              </Upload>,\r\n          )}\r\n        </Form.Item>\r\n    \r\n        <Form.Item label=\"略缩图\">\r\n          {getFieldDecorator('xx', {\r\n          })(\r\n      <Upload\r\n        name=\"avatar\"\r\n        listType=\"picture-card\"\r\n        showUploadList={false}\r\n        onChange={this.handleChange}\r\n\r\n      >\r\n        {imageUrl ? <img src={imageUrl} alt=\"avatar\" style={{ width: '100%' }} /> : uploadButton}\r\n      </Upload>\r\n        )}\r\n          <Modal visible={previewVisible} footer={null} onCancel={this.handleCancel}>\r\n          <img alt=\"example\" style={{ width: '100%' }} src={previewImage} />\r\n        </Modal>\r\n        \r\n              </Form.Item>\r\n\r\n\r\n        <Form.Item wrapperCol={{ span: 12, offset: 6 }}>\r\n          <Button type=\"primary\" htmlType=\"submit\">\r\n            提交\r\n          </Button>\r\n        </Form.Item>\r\n      </Form>\r\n    );\r\n  }\r\n}\r\n\r\nconst WrappedDemo = Form.create({ name: 'validate_other' })(Demo);\r\n\r\nReactDOM.render(<WrappedDemo />, document.getElementById('container'));\r\n"],"sourceRoot":""}